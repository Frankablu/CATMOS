desiredCapabilities(['requirement1','requirement2','requirement3','requirement4','requirement5','requirement6','requirement7','requirement8','requirement9','requirement10','requirement11','requirement12','requirement13','requirement14','requirement15','requirement16','requirement17','requirement18','requirement19','requirement20','requirement21','requirement22','requirement23','requirement24','requirement25','requirement26','requirement27','requirement28','requirement29','requirement30','requirement31','requirement32','requirement33','requirement34','requirement35','requirement36','requirement37','requirement38','requirement39','requirement40','requirement41','requirement42','requirement43','requirement44','requirement45','requirement46','requirement47','requirement48','requirement49','requirement50']).


capabilityDecomposes('',' ').

component('feature1:1').
component('feature2:1').
component('feature3:1').
component('feature4:1').
component('feature5:1').
component('feature6:1').
component('feature7:1').
component('feature8:1').
component('feature9:1').
component('feature10:1').
component('feature11:1').
component('feature12:1').
component('feature13:1').
component('feature14:1').
component('feature15:1').
component('feature16:1').
component('feature17:1').
component('feature18:1').
component('feature19:1').
component('feature20:1').
component('feature21:1').
component('feature22:1').
component('feature23:1').
component('feature24:1').
component('feature25:1').
component('feature26:1').
component('feature27:1').
component('feature28:1').
component('feature29:1').
component('feature30:1').
component('feature31:1').
component('feature32:1').
component('feature33:1').
component('feature34:1').
component('feature35:1').
component('feature36:1').
component('feature37:1').
component('feature38:1').
component('feature39:1').
component('feature40:1').
component('feature41:1').
component('feature42:1').
component('feature43:1').
component('feature44:1').
component('feature45:1').
component('feature46:1').
component('feature47:1').
component('feature48:1').
component('feature49:1').
component('feature50:1').

providesCapability('feature1:1',['requirement1'],'blank').
providesCapability('feature2:1',['requirement2'],'blank').
providesCapability('feature3:1',['requirement3'],'blank').
providesCapability('feature4:1',['requirement4'],'blank').
providesCapability('feature5:1',['requirement5'],'blank').
providesCapability('feature6:1',['requirement6'],'blank').
providesCapability('feature7:1',['requirement7'],'blank').
providesCapability('feature8:1',['requirement8'],'blank').
providesCapability('feature9:1',['requirement9'],'blank').
providesCapability('feature10:1',['requirement10'],'blank').
providesCapability('feature11:1',['requirement11'],'blank').
providesCapability('feature12:1',['requirement12'],'blank').
providesCapability('feature13:1',['requirement13'],'blank').
providesCapability('feature14:1',['requirement14'],'blank').
providesCapability('feature15:1',['requirement15'],'blank').
providesCapability('feature16:1',['requirement16'],'blank').
providesCapability('feature17:1',['requirement17'],'blank').
providesCapability('feature18:1',['requirement18'],'blank').
providesCapability('feature19:1',['requirement19'],'blank').
providesCapability('feature20:1',['requirement20'],'blank').
providesCapability('feature21:1',['requirement21'],'blank').
providesCapability('feature22:1',['requirement22'],'blank').
providesCapability('feature23:1',['requirement23'],'blank').
providesCapability('feature24:1',['requirement24'],'blank').
providesCapability('feature25:1',['requirement25'],'blank').
providesCapability('feature26:1',['requirement26'],'blank').
providesCapability('feature27:1',['requirement27'],'blank').
providesCapability('feature28:1',['requirement28'],'blank').
providesCapability('feature29:1',['requirement29'],'blank').
providesCapability('feature30:1',['requirement30'],'blank').
providesCapability('feature31:1',['requirement31'],'blank').
providesCapability('feature32:1',['requirement32'],'blank').
providesCapability('feature33:1',['requirement33'],'blank').
providesCapability('feature34:1',['requirement34'],'blank').
providesCapability('feature35:1',['requirement35'],'blank').
providesCapability('feature36:1',['requirement36'],'blank').
providesCapability('feature37:1',['requirement37'],'blank').
providesCapability('feature38:1',['requirement38'],'blank').
providesCapability('feature39:1',['requirement39'],'blank').
providesCapability('feature40:1',['requirement40'],'blank').
providesCapability('feature41:1',['requirement41'],'blank').
providesCapability('feature42:1',['requirement42'],'blank').
providesCapability('feature43:1',['requirement43'],'blank').
providesCapability('feature44:1',['requirement44'],'blank').
providesCapability('feature45:1',['requirement45'],'blank').
providesCapability('feature46:1',['requirement46'],'blank').
providesCapability('feature47:1',['requirement47'],'blank').
providesCapability('feature48:1',['requirement48'],'blank').
providesCapability('feature49:1',['requirement49'],'blank').
providesCapability('feature50:1',['requirement50'],'blank').

requiresCapability('feature1:1',['requirement27']).
requiresCapability('feature2:1',['requirement28']).
requiresCapability('feature3:1',['requirement42']).
requiresCapability('feature4:1',['requirement21']).
requiresCapability('feature5:1',['requirement33']).
requiresCapability('feature6:1',['requirement24']).
requiresCapability('feature7:1',['requirement12']).
requiresCapability('feature8:1',['requirement47']).
requiresCapability('feature9:1',['requirement26']).
requiresCapability('feature10:1',[]).
requiresCapability('feature11:1',[]).
requiresCapability('feature12:1',[]).
requiresCapability('feature13:1',['requirement48']).
requiresCapability('feature14:1',['requirement23']).
requiresCapability('feature15:1',['requirement35']).
requiresCapability('feature16:1',['requirement23']).
requiresCapability('feature17:1',['requirement34']).
requiresCapability('feature18:1',['requirement29']).
requiresCapability('feature19:1',['requirement28']).
requiresCapability('feature20:1',[]).
requiresCapability('feature21:1',['requirement37']).
requiresCapability('feature22:1',['requirement31']).
requiresCapability('feature23:1',[]).
requiresCapability('feature24:1',[]).
requiresCapability('feature25:1',['requirement38']).
requiresCapability('feature26:1',[]).
requiresCapability('feature27:1',[]).
requiresCapability('feature28:1',[]).
requiresCapability('feature29:1',[]).
requiresCapability('feature30:1',[]).
requiresCapability('feature31:1',['requirement37']).
requiresCapability('feature32:1',['requirement36']).
requiresCapability('feature33:1',[]).
requiresCapability('feature34:1',[]).
requiresCapability('feature35:1',[]).
requiresCapability('feature36:1',[]).
requiresCapability('feature37:1',[]).
requiresCapability('feature38:1',['requirement49']).
requiresCapability('feature39:1',[]).
requiresCapability('feature40:1',['requirement48']).
requiresCapability('feature41:1',['requirement42']).
requiresCapability('feature42:1',[]).
requiresCapability('feature43:1',[]).
requiresCapability('feature44:1',[]).
requiresCapability('feature45:1',[]).
requiresCapability('feature46:1',[]).
requiresCapability('feature47:1',[]).
requiresCapability('feature48:1',[]).
requiresCapability('feature49:1',['requirement50']).
requiresCapability('feature50:1',[]).

member(X,[X|_]).
member(X,[_|T]) :- member(X,T).

canProvideCap(Comp,Cap,Acc) :- findall(C,canProvideCapNormal(C,Cap,_),R),random_member(Comp,R),findall(Upgrade,canProvideCapNormal(Comp,Cap,Upgrade),Upgrades),random_member(Upgrade,Upgrades),createUpgrade(Upgrade,Acc).
canProvideCapNormal(Comp,Cap,Upgrade) :- providesCapability(Comp,List,Upgrade), member(Cap,List).

createUpgrade('blank',[]).
createUpgrade([H,H2|_],Acc) :- assert(H), canSatComp(H2,Acc).

canSatCap(Cap,Acc) :- canSatCap(Cap,Acc,scenario).
canSatCap(Cap,Acc,scenario) :- capabilityDecomposes(Cap,DCaps), canSatCaps(DCaps,Acc,scenario).
canSatCap(Cap,[(DComp,Cap,Comp),AccH|AccT],DComp) :- canProvideCap(Comp,Cap,AccH), canSatComp(Comp,AccT).

canSatComp(Comp,AccT) :- requiresCapability(Comp,Caps), canSatCaps(Caps,AccT,Comp).

canSatCaps([],[],_).
canSatCaps([Cap|T],[AccH|AccT],Comp) :- canSatCap(Cap,AccH,Comp), canSatCaps(T,AccT,Comp).

canMeetScenario(Acc) :- abolish(upgrade/3), dynamic(upgrade/3), desiredCapabilities(X), canSatCaps(X,Acc,scenario).
getUpgrades(R) :- findall((A,B,C),upgrade(A,B,C),R).

getSolution :- canMeetScenario(X), open('output11100.txt',write,Stream),write(Stream,X),nl(Stream),getUpgrades(Y),write(Stream,Y),close(Stream),halt.
